---
// Window component props interface
export interface Props {
  title: string;
  id: string;
  canMinimize?: boolean;
  canMaximize?: boolean;
  canClose?: boolean;
}

// Default props with optional controls
const {
  title,
  id,
  canMinimize = true,
  canMaximize = true,
  canClose = true,
} = Astro.props;
---

<!-- Main window container with Windows XP-like styling -->
<section
  id={id}
  class="flex flex-col justify-center items-center gap-3 text-center py-4 sm:py-8 w-full bg-gradient-to-b from-[#ece9d8] to-[#d4d0c8] border-2 border-[#0054e3] shadow-[4px_4px_0px_rgba(0,0,0,0.1)] transition-all duration-300 ease-in-out"
>
  <!-- Title bar with gradient background and window controls -->
  <div
    class="w-full h-6 bg-gradient-to-r from-[#0054e3] to-[#3a7ee8] -mt-4 sm:-mt-8 -mx-4 sm:-mx-8 mb-4 flex items-center px-2 justify-between cursor-move"
  >
    <span class="text-white text-sm ml-2 font-medium">{title}</span>

    <!-- Window control buttons container -->
    <div class="flex gap-1 ml-auto">
      <!-- Minimize button -->
      {
        canMinimize && (
          <button
            class="minimize-btn cursor-pointer w-4 h-4 flex items-center justify-center bg-gradient-to-b from-[#b5d3f3] to-[#b5d3f3] border border-[#3a6ea5] rounded-[2px] shadow-inner active:translate-y-px"
            onclick={`document.getElementById('${id}').classList.add('minimized')`}
          >
            <svg
              width="14"
              height="14"
              viewBox="0 0 14 14"
              class="block"
              fill="none"
            >
              <rect x="3" y="10" width="8" height="2" rx="1" fill="#245edc" />
              <rect
                x="3"
                y="10"
                width="8"
                height="2"
                rx="1"
                stroke="#245edc"
                stroke-width="0.5"
              />
            </svg>
          </button>
        )
      }
      <!-- Maximize button -->
      {
        canMaximize && (
          <button
            class="maximize-btn cursor-pointer w-4 h-4 flex items-center justify-center bg-gradient-to-b from-[#b5d3f3] to-[#b5d3f3] border border-[#3a6ea5] rounded-[2px] shadow-inner active:translate-y-px"
            onclick={`window.windowManager.toggleMaximize(document.getElementById('${id}'))`}
          >
            <svg
              width="14"
              height="14"
              viewBox="0 0 14 14"
              class="block"
              fill="none"
            >
              <rect
                x="3"
                y="3"
                width="8"
                height="8"
                rx="1"
                fill="none"
                stroke="#245edc"
                stroke-width="1"
              />
            </svg>
          </button>
        )
      }
      <!-- Close button -->
      {
        canClose && (
          <button
            class="close-btn cursor-pointer w-4 h-4 flex items-center justify-center bg-gradient-to-b from-[#ffa1a1] to-[#e35d5b] border border-[#a80000] rounded-[2px] shadow-inner active:translate-y-px"
            onclick={`document.getElementById('${id}').classList.add('hidden')`}
          >
            <svg
              width="14"
              height="14"
              viewBox="0 0 14 14"
              class="block"
              fill="none"
            >
              <line
                x1="4"
                y1="4"
                x2="10"
                y2="10"
                stroke="#fff"
                stroke-width="2"
                stroke-linecap="round"
              />
              <line
                x1="10"
                y1="4"
                x2="4"
                y2="10"
                stroke="#fff"
                stroke-width="2"
                stroke-linecap="round"
              />
            </svg>
          </button>
        )
      }
    </div>
  </div>
  <slot />
</section>

<style>
  /* Minimize animation - slides window to bottom of screen */
  .minimized {
    transform: translateY(calc(100vh - 2rem));
    opacity: 0.5;
  }

  /* Maximize animation - makes window fullscreen */
  .maximized {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    bottom: 0 !important;
    width: 100vw !important;
    height: 100vh !important;
    margin: 0 !important;
    z-index: 9999 !important;
    transform: none !important;
  }

  /* Restore button rotation when window is maximized */
  .maximized .maximize-btn svg {
    transform: rotate(180deg);
  }

  /* Smooth dragging transition */
  .dragging {
    transition: none !important;
    cursor: move !important;
    user-select: none !important;
  }

  /* Resize handles */
  .resize-handle {
    position: absolute;
    background: transparent;
    z-index: 1000;
  }

  /* Hide resize handles when maximized */
  .maximized .resize-handle {
    display: none;
  }

  /* North handle */
  .resize-handle-n {
    top: -4px;
    left: 4px;
    right: 4px;
    height: 8px;
  }

  /* East handle */
  .resize-handle-e {
    top: 4px;
    right: -4px;
    bottom: 4px;
    width: 8px;
  }

  /* South handle */
  .resize-handle-s {
    bottom: -4px;
    left: 4px;
    right: 4px;
    height: 8px;
  }

  /* West handle */
  .resize-handle-w {
    top: 4px;
    left: -4px;
    bottom: 4px;
    width: 8px;
  }

  /* Northeast handle */
  .resize-handle-ne {
    top: -4px;
    right: -4px;
    width: 8px;
    height: 8px;
  }

  /* Northwest handle */
  .resize-handle-nw {
    top: -4px;
    left: -4px;
    width: 8px;
    height: 8px;
  }

  /* Southeast handle */
  .resize-handle-se {
    bottom: -4px;
    right: -4px;
    width: 8px;
    height: 8px;
  }

  /* Southwest handle */
  .resize-handle-sw {
    bottom: -4px;
    left: -4px;
    width: 8px;
    height: 8px;
  }

  /* Resizing state */
  .resizing {
    transition: none !important;
    user-select: none !important;
  }
</style>

<script>
  import { WindowManager } from "./Window/windowManager";

  // Create window manager instance and make it globally accessible
  const windowManager = new WindowManager();
  (window as any).windowManager = windowManager;

  // Initialize draggable functionality for all windows
  document.addEventListener("DOMContentLoaded", () => {
    const windows = document.querySelectorAll('[id$="-window"]');
    windows.forEach((window) => {
      windowManager.initWindow(window.id);
    });

    // Update snap points when window is resized
    window.addEventListener("resize", () => {
      windowManager.updateSnapPoints();
    });
  });
</script>
